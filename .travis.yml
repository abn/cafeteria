language: python
dist: xenial
python:
    - 2.7
    - 3.5
    - 3.6
    - 3.7

env:
  global:
    - secure: "BuYrI/qD0hvNGaPkLnHsBV9hJrhhlRGhDMyrEjRAWtdrLnG9WZLdnRdCAjgVPQRaH/zkTsOgoF0C2vOP2uk0qbpnC3omWTYmK0TYgJQvSzU4+6YsrsRkvsDxyPIZgUdo8eDQ23ZT1e/RnLTJHHM9hSmQCn9f2ef0Gm+OpPABz6SCYFNnLWxbmABFKRHe8PnJIGZbUjYgBd1dsEC3WXW17Qz2Ka3IeU3D2O15YoE3dx3aq/mAQJUkPCOE9FodOauxVqDkKrhmMMw4Mb9Iqi9+uBSDAln8udWMznnDurLuQ9BglVYF9Req/OVpfXbybwl04cPGC6ZmHEcaO/DjU1m3qz2JF3JD2G9Bi/l9RtSW1/NvUiPDtc4gZ2CHi4liAPg86n1u0DBgeENaaHzpzCn9fOD9FPjQLe/jFr18eTwxO7OpeCtgr6ROoVyEKDegZ17ejWVe4V9BZ5Eu0sQR75S1PrhZD9+INAFh+V7XFD7HJSlMQqjyiUCBPFTWOvoFY5Hx/2Zs7FMoyk5GhPZv4DCR/PLMDGdWvpF9Kt/jbESIVq4vcqLcKh4Qn+t262pvgwqK55IHqsn+7oflTHLQz3/gBlgH+KPYvjBNHB17sQzXa6Eq5LMgaXJ/NOxFOm+LP/qq9rhbM6zS7M804tQKnx0ABUx3eCOl8TKwgZOUAXE+zM4="

install:
  - pip install poetry
  - poetry add --dev appdirs
  - poetry install

script: ignore

jobs:
  include:
    - stage: sonar
      python: 3.6
      addons:
        sonarcloud:
          organization: "abn-github"
          token:
            secure: "WX9mwPs3HVq4u6N9Nrlua4l3CxV+h9VGNZF3vR6SBZV6nJzQgfFKLvn8GjRktU1HgY3NvjOcs+nQrUmkH0FQeg544eCVhfxmUU/KkhCOEMD8Rpn6/kCXVZp8P2YIoRzehROPV45bB4TM+kw0u7bntM18CJFiC8gc30j/Ox27TVYBHtJh3mB+ueYjZGEckEFOZmR/r+IrC7otBApsghhRbp4+fg1f/1sWY2bhLx4rRa8sl5Le28Kuqu+Lh21Yj9UZvVsJFgP44lVm6olkG/7G23gEPlE/8FMkoTvaGUGfoAXwZgnbfLdwIuWjYxBgvM6MJMkbEJivRFiNSdjMf1ryyRiyHIE1Y703NtazMp/fm9oInv07Jrn3B2HUXQ4l8vUZjiJX4RiJ5tI3+lHTZRdkTrDdKDHT4fp3x7Q5PCdWOIrCjxtTAKUKijWCDNiftPZ6UWUACsXje9Uj+PD5UEK6Hnb7O9QYmaB4nWaFQ1hEchStCQer89Li/FSPxl/DkwQES8KcntKiQxgDEQn6NSEs0noBlwGhPb4B52fAoiQgLQV0X1ETaZR7Dr3tOrNS6IcLqw90OptmCTeXSqvaXGWytyTQyTPrshEsm3BvXJ6Co8sSYj+Yhi15QGxzeJf8JmuL3s0d+NyGeB5OlVy4kVrBPvInSzdaPsOyYXnbGN1MpO8="
          branches:
            - master
      script: sonar-scanner
    - stage: build
      python: 3.6
      script:
        - poetry build
      if: tag IS NOT present
    - stage: deploy
      python: 3.6
      script:
        - poetry config http-basic.pypi "@token" "${PYPI_API_TOKEN}"
        - poetry publish --build
      if: tag IS present
